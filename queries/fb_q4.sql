with desktop as ( select date_trunc('month', visitdate) as year_month_day, sourceip, countrycode, count(*) as visits, sum(adrevenue) as adrevenue, count(distinct languagecode) as languagecode, max(length(searchword)) as searchwordlength, sum(duration) as time_on_site from uservisits where sourceip in ('129.80.11.38') and countrycode < 'zzz' and visitdate between '2038-02-28' and '2039-07-29' and useragent = 'Rpwuh/1.2' group by sourceip,countrycode,year_month_day), mobile as ( select date_trunc('month', visitdate) as year_month_day, sourceip, countrycode, count(*) as visits, sum(adrevenue) as adrevenue, count(distinct languagecode) as languagecode, max(length(searchword)) as searchwordlength, sum(duration) as time_on_site from uservisits where sourceip in ('129.80.11.38') and countrycode < 'zzz' and visitdate between '2038-02-28' and '2039-07-29' and useragent = 'Krjxhzmhpzwlaau/2.6' group by sourceip,countrycode,year_month_day) select COALESCE(desktop.year_month_day,mobile.year_month_day) as year_month_day, COALESCE(desktop.sourceip,mobile.sourceip) as site, COALESCE(desktop.countrycode,mobile.countrycode) as countrycode, COALESCE(desktop.visits,0) + COALESCE(mobile.visits,0) as visits, COALESCE(desktop.adrevenue,0)+ COALESCE(mobile.adrevenue,0) as page_views, COALESCE(desktop.searchwordlength,0) + COALESCE(mobile.searchwordlength,0) as searchwordlength, COALESCE(desktop.time_on_site,0) + COALESCE(mobile.time_on_site,0) as time_on_site from desktop full outer join mobile on mobile.year_month_day = desktop.year_month_day AND mobile.sourceip = desktop.sourceip AND mobile.countrycode = desktop.countrycode ;